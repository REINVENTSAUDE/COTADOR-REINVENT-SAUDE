<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>REINVENT SAÚDE - COTADOR</title>

<style>
  :root{
    --azul:#005baa;
    --bg:#f5f7fb;
    --verde:#28a745;
    --borda:#d9d9d9;
    --texto:#111;
  }
/* ===== Marca d’água SOMENTE na tabela ===== */
.tabela-precos{
  position: relative;
  overflow: hidden;
  background:#fff;
}

/* marca d’água */
.tabela-precos::before{
  content:"";
  position:absolute;
  inset:0;
  background-image: url("logo-reinvent.png");
  background-repeat: no-repeat;
  background-position: center 70%; /* mais pra baixo, longe do cabeçalho */
  background-size: contain;        /* NÃO CORTA a logo */
  opacity: 0.07;                   /* ajusta visibilidade */
  z-index: 0;
  pointer-events:none;
}

/* garante que o conteúdo fique acima da marca */
.tabela-precos th,
.tabela-precos td{
  position: relative;
  z-index: 1;
}
  
  body{
    font-family: Arial, sans-serif;
    background:var(--bg);
    margin:0;
    padding:12px;
  }

  .container{
    max-width:900px;
    margin:auto;
    background:#fff;
    border-radius:12px;
    padding:15px;
    box-shadow:0 0 10px rgba(0,0,0,0.08);
  }

  .titulo{
    text-align:center;
    color:var(--azul);
    margin:6px 0 2px;
    font-size:22px;
    font-weight:800;
    letter-spacing:.2px;
  }

  .subtitulo{
    text-align:center;
    color:#3a3a3a;
    margin:0 0 14px;
    font-size:14px;
    font-weight:700;
  }

  /* ===== Seletor de planos (topo do vendedor) ===== */
  .planos{ display:grid; gap:12px; }

  .grupo-plano{
    display:grid;
    grid-template-columns: 2fr 1fr;
    gap:10px;
    align-items:stretch;
  }

  .tipo, .opcao{
    border:2px solid var(--azul);
    border-radius:10px;
    background:#fff;
    color:var(--azul);
    font-weight:800;
    cursor:pointer;
    transition: transform .18s ease, box-shadow .18s ease, background .18s ease, color .18s ease, opacity .18s ease;
    user-select:none;
  }

  .tipo{
    font-size:16px;
    padding:14px 12px;
    text-align:left;
  }
  .tipo small{
    display:block;
    font-weight:800;
    opacity:.95;
  }

  .opcoes{
    display:grid;
    grid-template-rows: 1fr 1fr;
    gap:8px;
  }

  .opcao{
    font-size:14px;
    padding:10px 8px;
  }

  .tipo:hover, .opcao:hover{ transform: scale(1.02); }

  .ativo{
    background:var(--azul) !important;
    color:#fff !important;
    box-shadow:0 10px 18px rgba(0,91,170,0.25);
    transform: scale(1.03);
  }

  /* Opções desativadas quando o tipo não está selecionado */
  .opcao.disabled{
    opacity:0.35;
    cursor:not-allowed;
    transform:none !important;
    box-shadow:none !important;
  }

  /* ===== Entrada ===== */
  .idades{ margin-top:12px; }
  textarea{
    width:100%;
    height:40px;
    padding:8px 10px;
    border:2px solid var(--borda);
    border-radius:10px;
    box-sizing:border-box;
    resize:none;
    font-size:14px;
  }

  .linha-opcoes{
    margin-top:10px;
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:center;
    font-size:14px;
  }

  .calcular{
    width:100%;
    margin-top:12px;
    padding:12px;
    background:var(--azul);
    color:#fff;
    border:none;
    border-radius:10px;
    font-size:16px;
    font-weight:800;
    cursor:pointer;
    transition:opacity .15s ease;
  }
  .calcular:hover{ opacity:0.92; }

  /* ===== Resultado ===== */
  #resultado{ display:none; margin-top:16px; }

  /* Somente esta área vira imagem */
  #areaImagem{
    border:1px solid #eee;
    border-radius:12px;
    padding:14px;
    background:#fff;
  }

  .logos{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:14px;
    margin-bottom:8px;
  }

  /* wrappers para "recortar" o vazio do PNG */
  .logo-wrap{
  height:46px;
  width:48%;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}

  .logo{
    width:100%;
    height:100%;
    display:block;
  }

  /* Hapvida geralmente já vem “no limite”, então mantém contain */
  .logo.hapvida{ object-fit:contain; }

  /* Reinvent veio com “margem” na imagem: usa cover para preencher e parecer do mesmo tamanho */
  .logo.reinvent{
  object-fit: contain;
  object-position: center;
  transform: scale(1.25);   /* aumenta só a Reinvent sem distorcer */
  transform-origin: center;
}

  #nomePlanoCliente{
    margin:8px 0 4px;
    color:var(--texto);
    font-size:18px;
    font-weight:800;
  }

  #linhaData{
    margin:0 0 8px;
    font-size:12px;
    color:#444;
    font-weight:700;
  }

  table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
    margin-top:8px;
  }
  th, td{
    padding:8px;
    border:1px solid #ddd;
    text-align:center;
  }
  th{
    background:var(--azul);
    color:#fff;
  }

  .totais{
    margin-top:10px;
    font-weight:800;
    display:grid;
    gap:4px;
  }

  .share{
    margin-top:10px;
    width:100%;
    padding:10px;
    background:var(--verde);
    color:#fff;
    border:none;
    border-radius:10px;
    font-size:15px;
    font-weight:800;
    cursor:pointer;
  }

  @media (max-width:520px){
    .logo-wrap{ width:160px; height:42px; }
  }
</style>
</head>

<body>
<div class="container" id="app">

  <div class="titulo">REINVENT SAÚDE - COTADOR</div>
  <div class="subtitulo">Fortaleza - CE</div>

  <!-- TOPO DO VENDEDOR (abreviado) -->
  <div class="planos">

    <div class="grupo-plano" data-plan="ind_enf">
      <button class="tipo" onclick="selecionarTipo('ind_enf', this)"><small>IND - ENFERMARIA</small></button>
      <div class="opcoes">
        <button class="opcao disabled" data-plan="ind_enf" data-modo="parcial" onclick="selecionarModo(this)">PARCIAL</button>
        <button class="opcao disabled" data-plan="ind_enf" data-modo="total" onclick="selecionarModo(this)">TOTAL</button>
      </div>
    </div>

    <div class="grupo-plano" data-plan="ind_amb">
      <button class="tipo" onclick="selecionarTipo('ind_amb', this)"><small>IND - AMBULATORIAL</small></button>
      <div class="opcoes">
        <button class="opcao disabled" data-plan="ind_amb" data-modo="parcial" onclick="selecionarModo(this)">PARCIAL</button>
        <button class="opcao disabled" data-plan="ind_amb" data-modo="total" onclick="selecionarModo(this)">TOTAL</button>
      </div>
    </div>

    <div class="grupo-plano" data-plan="ind_apto">
      <button class="tipo" onclick="selecionarTipo('ind_apto', this)"><small>IND - APARTAMENTO</small></button>
      <div class="opcoes">
        <button class="opcao disabled" data-plan="ind_apto" data-modo="parcial" onclick="selecionarModo(this)">PARCIAL</button>
        <button class="opcao disabled" data-plan="ind_apto" data-modo="total" onclick="selecionarModo(this)">TOTAL</button>
      </div>
    </div>

    <div class="grupo-plano" data-plan="ss_enf">
      <button class="tipo" onclick="selecionarTipo('ss_enf', this)"><small>SS - ENFERMARIA</small></button>
      <div class="opcoes">
        <button class="opcao disabled" data-plan="ss_enf" data-modo="parcial" onclick="selecionarModo(this)">PARCIAL</button>
        <button class="opcao disabled" data-plan="ss_enf" data-modo="total" onclick="selecionarModo(this)">TOTAL</button>
      </div>
    </div>

    <div class="grupo-plano" data-plan="ss_amb">
      <button class="tipo" onclick="selecionarTipo('ss_amb', this)"><small>SS - AMBULATORIAL</small></button>
      <div class="opcoes">
        <button class="opcao disabled" data-plan="ss_amb" data-modo="parcial" onclick="selecionarModo(this)">PARCIAL</button>
        <button class="opcao disabled" data-plan="ss_amb" data-modo="total" onclick="selecionarModo(this)">TOTAL</button>
      </div>
    </div>

  </div>

  <div class="idades">
    <textarea id="idades" placeholder="Digite as idades separadas por vírgula. Ex: 23, 35, 62"></textarea>
  </div>

  <div class="linha-opcoes">
    <label><input type="checkbox" id="familiar1grau" /> Familiar 1º grau (5% sobre o valor normal)</label>
  </div>

  <button class="calcular" onclick="calcular()">Calcular Orçamento</button>

  <!-- RESULTADO / IMAGEM -->
  <div id="resultado">
    <div id="areaImagem">
      <div class="logos">
        <div class="logo-wrap">
          <img src="logo-reinvent.png" class="logo reinvent" alt="Reinvent Saúde" />
        </div>
        <div class="logo-wrap">
          <img src="logo-hapvida.png" class="logo hapvida" alt="Hapvida" />
        </div>
      </div>

      <h2 id="nomePlanoCliente"></h2>
      <div id="linhaData"></div>

      <table class="tabela-precos">
        <thead id="cabecalhoTabela"></thead>
        <tbody id="tabelaResultado"></tbody>
      </table>

      <div class="totais">
        <div id="total1"></div>
        <div id="total2"></div>
      </div>
    </div>

    <button class="share" onclick="compartilharOrcamento()">Compartilhar Orçamento</button>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
  // ===== Estado =====
  let tipoSelecionado = null;    // ex: "ind_enf"
  let modoSelecionado = null;    // "parcial" | "total"

  // ===== Nome completo para o cliente =====
  // (No orçamento SS vira "PLANO EMPRESARIAL ...")
  const nomesClienteBase = {
    ind_enf: "INDIVIDUAL ENFERMARIA COPARTICIPAÇÃO",
    ind_amb: "INDIVIDUAL AMBULATORIAL COPARTICIPAÇÃO",
    ind_apto:"INDIVIDUAL APARTAMENTO COPARTICIPAÇÃO",
    ss_enf:  "SUPER SIMPLES ENFERMARIA COPARTICIPAÇÃO",
    ss_amb:  "SUPER SIMPLES AMBULATORIAL COPARTICIPAÇÃO"
  };

  function isSuperSimples(tipo){
    return typeof tipo === "string" && tipo.startsWith("ss_");
  }

  function nomeClienteCompleto(tipo, modo){
    let base = nomesClienteBase[tipo] || "";
    if(isSuperSimples(tipo)){
      base = base.replace(/^SUPER SIMPLES /, "PLANO EMPRESARIAL ");
    }
    const mod = (modo || "").toUpperCase();
    return `${base} ${mod}`.trim();
  }

  function dataHojeBR(){
    const d = new Date();
    const dd = String(d.getDate()).padStart(2,"0");
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const yyyy = d.getFullYear();
    return `${dd}/${mm}/${yyyy}`;
  }

  // ===== Tabelas (normal e 15%) =====
  // Formato: [faixaLabel, minIdade, maxIdade, valorNormal, valor15]
  const tabelas = {
    // IND - ENFERMARIA
    ind_enf_parcial: [
      ["00 a 18",0,18,241.68,205.43],["19 a 23",19,23,311.18,264.50],["24 a 28",24,28,354.18,301.05],
      ["29 a 33",29,33,393.74,334.68],["34 a 38",34,38,412.20,350.37],["39 a 43",39,43,462.60,393.21],
      ["44 a 48",44,48,558.98,475.13],["49 a 53",49,53,762.08,647.77],["54 a 58",54,58,1020.23,867.20],
      ["59+",59,200,1318.95,1121.11]
    ],
    ind_enf_total: [
      ["00 a 18",0,18,198.23,168.50],["19 a 23",19,23,253.82,215.75],["24 a 28",24,28,288.22,244.99],
      ["29 a 33",29,33,319.87,271.89],["34 a 38",34,38,334.64,284.44],["39 a 43",39,43,374.96,318.72],
      ["44 a 48",44,48,452.06,384.25],["49 a 53",49,53,614.53,522.35],["54 a 58",54,58,821.04,697.88],
      ["59+",59,200,1060.00,901.00]
    ],

    // IND - AMBULATORIAL
    ind_amb_parcial: [
      ["00 a 18",0,18,202.80,172.38],["19 a 23",19,23,267.06,227.00],["24 a 28",24,28,304.44,258.77],
      ["29 a 33",29,33,339.61,288.67],["34 a 38",34,38,357.41,303.80],["39 a 43",39,43,401.25,341.06],
      ["44 a 48",44,48,490.67,417.07],["49 a 53",49,53,680.53,578.45],["54 a 58",54,58,917.37,779.76],
      ["59+",59,200,1191.43,1012.72]
    ],
    ind_amb_total: [
      ["00 a 18",0,18,130.22,110.69],["19 a 23",19,23,171.04,145.38],["24 a 28",24,28,194.78,165.56],
      ["29 a 33",29,33,217.12,184.55],["34 a 38",34,38,228.42,194.16],["39 a 43",39,43,256.27,217.83],
      ["44 a 48",44,48,313.06,266.10],["49 a 53",49,53,433.65,368.60],["54 a 58",54,58,584.08,496.47],
      ["59+",59,200,758.15,644.43]
    ],

    // IND - APARTAMENTO
    ind_apto_parcial: [
      ["00 a 18",0,18,350.27,297.73],["19 a 23",19,23,454.52,386.34],["24 a 28",24,28,519.02,441.17],
      ["29 a 33",29,33,578.36,491.61],["34 a 38",34,38,606.05,515.14],["39 a 43",39,43,681.65,579.40],
      ["44 a 48",44,48,826.22,702.29],["49 a 53",49,53,1130.87,961.24],["54 a 58",54,58,1518.10,1290.39],
      ["59+",59,200,1966.18,1671.25]
    ],
    ind_apto_total: [
      ["00 a 18",0,18,285.10,242.34],["19 a 23",19,23,368.49,313.22],["24 a 28",24,28,420.09,357.08],
      ["29 a 33",29,33,467.56,397.43],["34 a 38",34,38,489.71,416.25],["39 a 43",39,43,550.19,467.66],
      ["44 a 48",44,48,665.84,565.96],["49 a 53",49,53,909.55,773.12],["54 a 58",54,58,1219.32,1036.42],
      ["59+",59,200,1577.77,1341.10]
    ],

    // SS - ENFERMARIA
    ss_enf_parcial: [
      ["00 a 18",0,18,187.76,159.60],["19 a 23",19,23,210.29,178.75],["24 a 28",24,28,235.52,200.19],
      ["29 a 33",29,33,270.85,230.22],["34 a 38",34,38,311.48,264.76],["39 a 43",39,43,370.66,315.06],
      ["44 a 48",44,48,463.33,393.83],["49 a 53",49,53,579.16,492.29],["54 a 58",54,58,984.57,836.88],
      ["59+",59,200,1102.72,937.31]
    ],
    ss_enf_total: [
      ["00 a 18",0,18,146.72,124.71],["19 a 23",19,23,164.33,139.68],["24 a 28",24,28,184.05,156.44],
      ["29 a 33",29,33,211.66,179.91],["34 a 38",34,38,243.41,206.90],["39 a 43",39,43,289.66,246.21],
      ["44 a 48",44,48,362.08,307.77],["49 a 53",49,53,452.60,384.71],["54 a 58",54,58,769.42,654.01],
      ["59+",59,200,861.75,732.49]
    ],

    // SS - AMBULATORIAL
    ss_amb_parcial: [
      ["00 a 18",0,18,139.18,118.30],
      ["19 a 23",19,23,155.88,132.50],
      ["24 a 28",24,28,174.59,148.40],
      ["29 a 33",29,33,200.78,170.66],
      ["34 a 38",34,38,230.90,196.27],
      ["39 a 43",39,43,274.77,233.55],
      ["44 a 48",44,48,343.46,291.94],
      ["49 a 53",49,53,429.33,364.93],
      ["54 a 58",54,58,729.86,620.38],
      ["59+",59,200,817.44,694.82]
    ],
    ss_amb_total: [
      ["00 a 18",0,18,102.77,87.35],
      ["19 a 23",19,23,115.10,97.84],
      ["24 a 28",24,28,128.91,109.57],
      ["29 a 33",29,33,148.25,126.01],
      ["34 a 38",34,38,170.49,144.92],
      ["39 a 43",39,43,202.88,172.45],
      ["44 a 48",44,48,253.60,215.56],
      ["49 a 53",49,53,317.00,269.45],
      ["54 a 58",54,58,538.90,458.07],
      ["59+",59,200,603.57,513.03]
    ]
  };

  // ===== UI helpers =====
  function esconderResultado(){
    document.getElementById("resultado").style.display = "none";
    setTimeout(() => {
  document.getElementById("resultado").scrollIntoView({
    behavior: "smooth",
    block: "start"
  });
}, 100);

    document.getElementById("tabelaResultado").innerHTML = "";
    document.getElementById("cabecalhoTabela").innerHTML = "";
    document.getElementById("total1").textContent = "";
    document.getElementById("total2").textContent = "";
    document.getElementById("nomePlanoCliente").textContent = "";
    document.getElementById("linhaData").textContent = "";
  }

  function atualizarOpcoesAtivas(){
    document.querySelectorAll(".opcao").forEach(btn=>{
      const plan = btn.dataset.plan;
      if(plan === tipoSelecionado){
        btn.classList.remove("disabled");
      } else {
        btn.classList.add("disabled");
        btn.classList.remove("ativo");
      }
    });
  }

  // ===== Seleção =====
  function selecionarTipo(planKey, btn){
  tipoSelecionado = planKey;
  modoSelecionado = null;

  document.querySelectorAll(".tipo").forEach(b=>b.classList.remove("ativo"));
  btn.classList.add("ativo");

  atualizarOpcoesAtivas();
  esconderResultado();

  const chkFamiliar = document.getElementById("familiar1grau");

  if(isSuperSimples(planKey)){
    chkFamiliar.checked = false;
    chkFamiliar.disabled = true;
  } else {
    chkFamiliar.disabled = false;
  }
}

  function selecionarModo(btn){
    const plan = btn.dataset.plan;
    const modo = btn.dataset.modo;

    if(!tipoSelecionado || plan !== tipoSelecionado || btn.classList.contains("disabled")){
      return;
    }

    modoSelecionado = modo;

    const bloco = btn.closest(".grupo-plano");
    bloco.querySelectorAll(".opcao").forEach(b=>b.classList.remove("ativo"));
    btn.classList.add("ativo");

    esconderResultado();
  }

  // ===== Cálculo =====
  function parseIdades(){
    return document.getElementById("idades").value
      .split(",")
      .map(s => parseInt(s.trim(), 10))
      .filter(n => Number.isFinite(n));
  }

  function encontrarFaixa(lista, idade){
    return lista.find(f => idade >= f[1] && idade <= f[2]);
  }

  function montarCabecalhoTabela(familiar){
    const thead = document.getElementById("cabecalhoTabela");
    if(familiar){
      thead.innerHTML = `
        <tr>
          <th>Faixa Etária</th>
          <th>Idade</th>
          <th>15% (3 meses)</th>
          <th>5% Familiar</th>
        </tr>
      `;
    } else {
      thead.innerHTML = `
        <tr>
          <th>Faixa Etária</th>
          <th>Idade</th>
          <th>Valor Normal</th>
          <th>15% (3 meses)</th>
        </tr>
      `;
    }
  }

  function calcular(){
    if(!tipoSelecionado || !modoSelecionado){
      alert("Selecione o plano e depois PARCIAL ou TOTAL.");
      return;
    }

    const idades = parseIdades();
    if(idades.length === 0){
      alert("Informe ao menos uma idade (ex: 23, 35, 62).");
      return;
    }

    if(isSuperSimples(tipoSelecionado) && idades.length < 2){
      alert("Plano coletivo: mínimo 2 vidas (duas idades).");
      return;
    }

    const chave = `${tipoSelecionado}_${modoSelecionado}`;
    const lista = tabelas[chave];
    if(!lista){
      alert("Tabela não encontrada para este plano.");
      return;
    }

    const familiar = document.getElementById("familiar1grau").checked;

    montarCabecalhoTabela(familiar);

    const tbody = document.getElementById("tabelaResultado");
    tbody.innerHTML = "";

    let totalNormal = 0;
    let total15 = 0;
    let total5 = 0; // 5% sobre o normal

    idades.forEach(idade=>{
      const faixa = encontrarFaixa(lista, idade);
      if(!faixa) return;

      const vN = Number(faixa[3]) || 0;
      const v15 = Number(faixa[4]) || 0;
      const v5 = vN * 0.95;

      totalNormal += vN;
      total15 += v15;
      total5 += v5;

      const tr = document.createElement("tr");

      if(familiar){
        tr.innerHTML = `
          <td>${faixa[0]}</td>
          <td>${idade}</td>
          <td>R$ ${v15.toFixed(2)}</td>
          <td>R$ ${v5.toFixed(2)}</td>
        `;
      } else {
        tr.innerHTML = `
          <td>${faixa[0]}</td>
          <td>${idade}</td>
          <td>R$ ${vN.toFixed(2)}</td>
          <td>R$ ${v15.toFixed(2)}</td>
        `;
      }

      tbody.appendChild(tr);
    });

    document.getElementById("nomePlanoCliente").textContent = nomeClienteCompleto(tipoSelecionado, modoSelecionado);
    document.getElementById("linhaData").textContent = `Orçamento dia ${dataHojeBR()}`;

    if(familiar){
      document.getElementById("total1").textContent = `Total 15% (3 meses): R$ ${total15.toFixed(2)}`;
      document.getElementById("total2").textContent = `Total 5% Familiar: R$ ${total5.toFixed(2)}`;
    } else {
      document.getElementById("total1").textContent = `Total normal: R$ ${totalNormal.toFixed(2)}`;
      document.getElementById("total2").textContent = `Total 15% (3 meses): R$ ${total15.toFixed(2)}`;
    }

    document.getElementById("resultado").style.display = "block";
  }

  // ===== Compartilhar (imagem só do orçamento) =====
  async function compartilharOrcamento(){
    const area = document.getElementById("areaImagem");

    const canvas = await html2canvas(area, {
      backgroundColor: "#ffffff",
      useCORS: true,
      scale: 2
    });

    return new Promise(resolve=>{
      canvas.toBlob(async (blob)=>{
        try{
          const file = new File([blob], "orcamento_reinvent_hapvida.png", { type:"image/png" });

          if(navigator.share && navigator.canShare && navigator.canShare({ files:[file] })){
            await navigator.share({ title: "Orçamento", files: [file] });
          } else if(navigator.share){
            await navigator.share({ title: "Orçamento", files: [file] });
          } else {
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "orcamento_reinvent_hapvida.png";
            a.click();
            URL.revokeObjectURL(a.href);
          }
        } catch(e){
          const a = document.createElement("a");
          a.href = canvas.toDataURL("image/png");
          a.download = "orcamento_reinvent_hapvida.png";
          a.click();
        }
        resolve();
      }, "image/png");
    });
  }
</script>
</body>
</html>
